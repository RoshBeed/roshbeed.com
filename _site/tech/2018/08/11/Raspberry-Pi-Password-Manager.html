<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Raspberry Pi Password Manager</title>
  <meta name="description" content="DevOps Engineer">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
  <link rel="manifest" href="/img/favicon/manifest.json">
  <link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#131d28">
  <link rel="shortcut icon" href="/img/favicon/favicon.ico">
  <meta name="apple-mobile-web-app-title" content="Rosh Beedassee">
  <meta name="application-name" content="Rosh Beedassee">
  <meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
  <meta name="theme-color" content="#131d28">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css" type="text/css" >
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="//cdn.rawgit.com/konpa/devicon/master/devicon.min.css" type="text/css">
  <link rel="stylesheet" href="/css/main.css">
</head>

  <body>
    <a href="/">
  <div id="particles-js" class="particles-small">
    <div class="post-title">
      <img class="small-profile" src="/img/profile.png"></img>
      <h1 class="site-title">Rosh Beedassee</h1>
    </div>
  </div>
</a>

    <div class="content">
  <section id="post">
    <div class="container post">
      <h1>Raspberry Pi Password Manager</h1>
      <img alt="Raspberry Pi" src="/img/Raspberry-Pi-Password-Manager/Raspberry-Pi-Password-Manager-1.jpg" />
      <p>As data breaches become increasingly common, securing our online accounts is more important than ever. Cloud-based password managers serve to free us from the need to remember passwords but what of those who don’t want to store their passwords online (or are excessively paranoid)? In this post, we will set up a Raspberry Pi 3 with Raspbian and a Git repository which we will use to store our passwords.</p>

<p>We will use pass to manage our passwords.</p>

<p>Once set up we will have the ability to access our password from any *nix operating system.</p>

<h2 id="content">Content</h2>

<ul>
  <li><a href="#raspberry-pi-setup">Raspberry Pi setup</a></li>
  <li><a href="#local-machine-setup">Local machine setup</a></li>
  <li><a href="#secondary-machine-setup">Secondary machine setup</a></li>
  <li><a href="#software-used">Software used</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="raspberry-pi-setup">Raspberry Pi setup</h2>

<p>This part documents how to install the Raspbian operating system, setup a SSH connection, create a Git repository and a little configuration to secure our device.</p>

<p>Download latest Raspbian image</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget https://downloads.raspberrypi.org/raspbian_lite_latest
</code></pre></div></div>

<p>Extract the image</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ unzip raspbian_lite_latest
</code></pre></div></div>

<p>Write image to our SD card</p>
<pre>
# dd if=./*raspbian*.img of=/dev/sd<b>&lt;XX&gt;</b>
</pre>

<p>Mount the boot partition from our SD card</p>
<pre>
# mount /dev/sd<b>&lt;X&gt;</b>1 ./boot
</pre>

<p>Enable SSH</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ touch ./boot/ssh
</code></pre></div></div>

<p>Set Wi-Fi credentials</p>
<pre>
$ echo "network={\n \
    ssid=\"<b>&lt;your ssid&gt;</b>\"\n \
    psk=\"<b>&lt;your password&gt;</b>\"\n \
}" &gt; ./boot/wpa_supplicant.conf
</pre>

<p>Unmount boot partition</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ umount ./boot
</code></pre></div></div>

<p>Clean up files no longer needed</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rm *raspbian*
</code></pre></div></div>

<p>The SD card has been prepared. We have configured it to automatically connect to our Wi-Fi network and enabled SSH.</p>

<p>It is time to insert the SD card into our Raspberry Pi and turn it on.</p>

<p>The next step is to setup the SSH connection and Git repository.</p>

<p>Generate SSH key pair</p>

<pre>
ssh-keygen -q -t rsa -f $HOME/.ssh/id_rsa -P "<b>&lt;passphrase&gt;</b>"
</pre>

<p>Copy SSH public key to Raspberry Pi</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh-copy-id pi@raspberrypi.local
</code></pre></div></div>

<p>SSH into Raspberry Pi</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh pi@raspberrypi.local
</code></pre></div></div>

<p>Change the default password to something secure</p>

<pre>
# echo 'pi:<b>&lt;newpassword&gt;</b>' | chpasswd
</pre>

<p>Disable SSH password authentication</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo grep -q "^[^#]*PasswordAuthentication" /etc/ssh/sshd_config &amp;&amp; sed -i "/^[^#]*PasswordAuthentication[[:space:]]yes/c\PasswordAuthentication no" /etc/ssh/sshd_config || echo "PasswordAuthentication no" &gt;&gt; /etc/ssh/sshd_config
$ systemctl restart sshd
</code></pre></div></div>

<p>Install Git</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># apt-get update -y &amp;&amp; apt-get install git -y
</code></pre></div></div>

<p>Initialise Git repository</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git init --bare ~/.password-store
</code></pre></div></div>

<h2 id="local-machine-setup">Local machine setup</h2>

<p><img src="/img/Raspberry-Pi-Password-Manager/Raspberry-Pi-Password-Manager-2.png" alt="Password Store" title="Local machine setup" /></p>

<p>Now we will initialise the password store and push it to the repository we have created on the Raspberry Pi.</p>

<p>Install gnupg and pass</p>

<p>The command you need will differ depending on your distribution, e.g.:</p>

<p>Arch:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># pacman -Syu gnupg pass
</code></pre></div></div>

<p>Ubuntu:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># apt-get install gnupg pass
</code></pre></div></div>

<h4 id="gpg-setup">GPG setup</h4>

<p>Create GPG keys</p>

<pre>
$ cat &gt;foo &lt;&lt;EOF
     Key-Type: default
     Key-Length: 4096
     Subkey-Type: default
     Subkey-Length: 4096
     Name-Real: <b>&lt;John Doe&gt;</b>
     Name-Email: <b>&lt;johndoe@example.com&gt;</b>
     Passphrase: <b>&lt;passphrase&gt;</b>
     %commit
EOF
$ gpg --batch --generate-key foo
$ rm foo
</pre>

<p>Export the GPG key pair</p>

<pre>
$ gpg --export-secret-keys --armor <b>&lt;johndoe@example.com&gt;</b> &gt; \&lt;<b>&lt;johndoe@example.com&gt;</b>\&gt;.gpg-secret
$ gpg --export --armor <b>&lt;johndoe@example.com&gt;</b> &gt; \&lt;<b>&lt;johndoe@example.com&gt;</b>\&gt;.gpg-public
</pre>

<p>You might want to look into using seperate siging keys for each device. This would make it easier to revoke a single key if you lose that device.</p>

<h4 id="pass-setup">Pass setup</h4>

<p>Initialise password store</p>
<pre>
$ pass init <b>&lt;johndoe@example.com&gt;</b>
</pre>

<p>Initialise Git repo</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pass git init
</code></pre></div></div>

<p>Add remote Raspberry Pi repository</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pass git remote add origin pi@raspberrypi.local:~/.password-store
</code></pre></div></div>

<p>Push to Raspberry Pi repository</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pass git push
</code></pre></div></div>

<h2 id="secondary-machine-setup">Secondary machine setup</h2>

<p>We will learn how to use our password store on other devices</p>

<p>Generate new SSH key pair for new machine</p>

<pre>
ssh-keygen -q -t rsa -f <b>&lt;id_newmachine&gt;</b> -P "<b>&lt;passphrase&gt;</b>"
</pre>

<p>Copy public SSH key to Raspberry Pi</p>
<pre>
$ ssh-copy-id -i <b>&lt;id_newmachine&gt;</b> pi@raspberry.local
</pre>

<p>Copy private SSH key to new machine</p>
<pre>
$ scp <b>&lt;id_newmachine&gt;</b> <b>&lt;user@newmachine&gt;</b>:~/.ssh/id_rsa
</pre>

<p>Copy GPG key pair to new machine</p>
<pre>
$ scp \&lt;<b>&lt;johndoe@example.com&gt;</b>\&gt;.gpg-&#42; <b>&lt;user@newmachine&gt;:~/</b>
</pre>

<p>SSH into new machine</p>
<pre>
$ ssh <b>&lt;user@newmachine&gt;</b>
</pre>

<p>Import GPG keys</p>
<pre>
$ gpg --import \&lt;<b>&lt;johndoe@example.com&gt;</b>\&gt;.gpg-public
$ gpg --allow-secret-key-import \&lt;<b>&lt;johndoe@example.com&gt;</b>\&gt;.gpg-secret
</pre>

<p>Use Git to clone password store from Raspberry Pi to our machine</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone ssh://pi@raspberry.local:~/password-store
</code></pre></div></div>

<p>You should now be able to use pass in the same way as you do on your other machine.</p>

<h2 id="software-used">Software used</h2>
<ul>
  <li><a href="https://www.gnupg.org/">gpg</a></li>
  <li><a href="https://www.passwordstore.org/">pass</a></li>
  <li><a href="https://git-scm.com/">git</a></li>
  <li><a href="https://www.openssh.com/">ssh</a></li>
</ul>

<h2 id="conclusion">Conclusion</h2>
<p>You can only push and pull passwords when on the same local network as the Raspberry Pi.</p>

<p>You must pull your passwords when on your local network. You are able to use them while disconnected. If you add new passwords while disconnected you must join your local network to be able to push them to the Raspberry Pi.</p>

<p>Here’s the  reason I chose not to expose my password store to the Internet: There could be undiscovered security bugs in the software used. If it is exposed to the the Internet and a bug is discovered, in the time between realising the issue and updating the software the passwords may be comprimised</p>

<p>If you would like access to you password store over the internet you will need to forward ports on your router to allow access to your Raspberry Pi.</p>

<p>In the next post we will look at how to use your password store on other operating system (Android &amp; Windows).</p>

      

<div id="share-buttons">
  <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=http://localhost:4000/tech/2018/08/11/Raspberry-Pi-Password-Manager.html');">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/>
    </svg>
  </div>
  <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=http://localhost:4000/tech/2018/08/11/Raspberry-Pi-Password-Manager.html');">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/>
    </svg>
  </div>
  <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/tech/2018/08/11/Raspberry-Pi-Password-Manager.html&title=&summary=&source=');">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/>
    </svg>
  </div>
  <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=http://localhost:4000/tech/2018/08/11/Raspberry-Pi-Password-Manager.html');">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/>
    </svg>
  </div>
</div>

    </div>
  </section>
</div>

    <footer class="footer">
  <p>Rosh Beedassee</p>
</footer>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="//cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="/js/app.js"></script>

  </body>
</html>
